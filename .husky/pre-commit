#!/usr/bin/env sh

# ── Step 1: lint-staged (ESLint on staged .ts/.js files) ──
npx lint-staged

# ── Step 2: Gitleaks (secret scan on staged diffs) ──
if command -v gitleaks >/dev/null 2>&1; then
  gitleaks protect --staged --verbose
else
  echo "⚠ gitleaks not installed locally — skipping. CI will catch secrets."
fi

# ── Step 3: Semgrep (custom rules on staged files) ──
if command -v semgrep >/dev/null 2>&1; then
  # Get list of staged .ts/.js files
  STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR -- '*.ts' '*.js')
  if [ -n "$STAGED_FILES" ]; then
    echo "$STAGED_FILES" | xargs semgrep --config .semgrep.yml --error --severity ERROR --quiet
  fi
else
  echo "⚠ semgrep not installed locally — skipping. CI will catch issues."
fi
